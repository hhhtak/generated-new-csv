# 要件書

## はじめに

この機能は、設定可能な変換ルールに基づいて入力 CSV ファイルを出力 CSV ファイルに変換する柔軟な CSV 変換ツールを実装します。このツールは、外部設定ファイルを通じて列の並び替え、値の置換、ヘッダーのカスタマイズをサポートし、様々なデータ変換シナリオに適応できます。

## 要件

### 要件 1

**ユーザーストーリー:** データアナリストとして、CSV ファイル A をカスタム変換で CSV ファイル B に変換したい。これにより、異なるシステム間でデータ形式を標準化できる。

#### 受け入れ基準

1. ユーザーが入力 CSV ファイルを提供した場合、システムは CSV データを読み取り、解析する必要がある
2. ユーザーが出力ファイルパスを提供した場合、システムは指定された場所に新しい CSV ファイルを作成する必要がある
3. 変換プロセスが正常に完了した場合、システムは変換中にデータの整合性を保持する必要がある

### 要件 2

**ユーザーストーリー:** ユーザーとして、出力 CSV の列ヘッダーをカスタマイズしたい。これにより、ヘッダーがターゲットシステムの要件に一致する。

#### 受け入れ基準

1. システムが最初の行をヘッダーとして処理する場合、1 行目を列タイトルとして扱う必要がある
2. 設定で新しいヘッダー名が指定されている場合、システムは元のヘッダーを指定された名前に置き換える必要がある
3. 列にヘッダーマッピングが提供されていない場合、システムは元のヘッダー名を保持する必要がある

### 要件 3

**ユーザーストーリー:** ユーザーとして、出力 CSV の列を並び替えたい。これにより、列の順序がターゲット形式に一致する。

#### 受け入れ基準

1. 設定で列の順序が指定されている場合、システムは指定された順序に従って出力列を配置する必要がある
2. 順序設定で列が指定されていない場合、システムはその列を出力から除外する必要がある
3. 指定された列が入力に存在しない場合、システムは欠如している列名でエラーを報告する必要がある

### 要件 4

**ユーザーストーリー:** ユーザーとして、指定された列の特定の値を置換したい。これにより、データ表現を標準化できる（例：「あり/なし」を「1/0」に）。

#### 受け入れ基準

1. 設定で列の値置換が指定されている場合、システムはその列の一致するすべての値に置換を適用する必要がある
2. 同じ列に複数の置換ルールが存在する場合、システムは適用可能なすべての置換を適用する必要がある
3. 値が置換ルールに一致しない場合、システムは元の値を変更せずに保持する必要がある

### 要件 5

**ユーザーストーリー:** ユーザーとして、変換に外部設定ファイルを使用したい。これにより、コードを変更することなく変換ルールを簡単に修正できる。

#### 受け入れ基準

1. システムが開始される場合、設定ファイルから変換ルールを読み込む必要がある
2. 設定ファイルが見つからないか無効な場合、システムは明確なエラーメッセージを報告する必要がある
3. 設定ファイルが更新された場合、システムは後続の変換で新しいルールを使用する必要がある
4. 設定が提供されていない場合、システムは変換なしで直接コピーを実行する必要がある

### 要件 6

**ユーザーストーリー:** ユーザーとして、明確なエラーハンドリングとフィードバックが欲しい。これにより、変換が失敗した際に問題をトラブルシューティングできる。

#### 受け入れ基準

1. 入力 CSV ファイルが見つからないか読み取れない場合、システムはファイルアクセスエラーを報告する必要がある
2. CSV 形式が無効な場合、システムは行番号付きの解析エラーを報告する必要がある
3. 設定ルールが存在しない列を参照している場合、システムは欠如している列を報告する必要がある
4. 出力ディレクトリが書き込み可能でない場合、システムは権限エラーを報告する必要がある
